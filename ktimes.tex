\section{任意回連続微分可能関数と常微分方程式}

この節では定理 \ref{KTimesIsCH}, 
つまり$(\infty, k)$階連続微分可能な関数の常微分方程式の解は
\DIVPlog 困難でありうることを示す.
証明の流れは \ref{section:differentiable} 節とほぼ同じである.
\ifnum \proc = 1
ただし紙面の都合上, 詳細な証明は省き, 証明の概略を説明するに止める.
\fi


\subsection{$\classCH$ 困難な言語}

各 $\C_n \classP$ に対して完全問題が存在する.
言語 $\C_n B_{be}$ を以下のように定義する.
\[
 \langle F(\vec x_1, \dots, \vec x_n), m_1, \dots, m_n \rangle \in \C_n B_{be}
 \longleftrightarrow
 \C^{m_1}_{\vec \alpha_1} \cdots \C^{m_n}_{\vec \alpha_n} F(\vec \alpha_1, \dots, \vec \alpha_n) 
\]

\begin{lemma}[\cite{wagner1986complexity}]
 $\C_n B_{be}$ は $\C_n\classP$ にたいして対数領域多対一完全.
\end{lemma}

\begin{lemma}
 $\C_n B_{be}$ は $\C_n\classP$ にたいして多項式時間完全.
 \footnote{証明で使うとき、補題の強さはこの程度で十分}
\end{lemma}

言語 $\C_{\log} B_{be}$ を以下のように定義する.
\[
 \langle 0^{2^n}, u \rangle \in \C_{\log} B_{be}
 \longleftrightarrow
 u \in \C_n B_{be}
\]

\begin{lemma}
 $\C_{\log} B_{be}$ は $\classCH$ 困難.
\end{lemma}

\begin{proof}
 $\forall A \in \classCH$, $\exists n \in \N$, $\exists f \in \mathbf{FP}$
 \begin{align}
  u \in A 
  & \longleftrightarrow f(u) \in \C_n B_{be}\\
  & \longleftrightarrow \langle 0^{2^n}, f(u) \rangle \in \C_{\log} B_{be}
 \end{align}
 $n$ は定数であるため $\langle 0^{2^n}, f(\cdot) \rangle \in \mathbf{FP}$.
\end{proof}

\begin{lemma}
 $\C_{\log} B_{be} \in \DIVPlog$.
\end{lemma}


\begin{collorary}
 $\classCH  \subseteq \bf DIVP(const)$.
\end{collorary}
$\classCH = \bf DIVP(const)$ だが本稿では証明はしない.


\subsection{対数段差分方程式を模倣する関数族}

 \begin{lemma}
  \label{KTimesFamily}
  任意の自然数 $k \ge 2$,
  任意の言語 $L \in \DIVPlog$ に対して,
  係数のみに $i$ を含む多項式 $\mu_i$ が存在して,
  任意の多項式 $\gamma$ に対して,
  関数 $\rho \colon \N \to \N$, 関数族 $g_u, h_u$ で,
  $\rho, (g_u)_u$ は多項式時間計算可能であり,
  各文字列 $u$ に対して以下を満たすものが存在する.
  \begin{enumerate}
   \item $g_u\colon [0,1] \times [-1,1]\to \R, \quad h_u\colon [0,1] \to [-1,1]$;
   \item $h_u$ は $g_u$ の常微分方程式 (\ref{eq:ode}) の解;
   \item $g_u$ は $(\infty, k)$ 階連続微分可能;
   \item 任意の $i \in \N$, $y \in [-1,1]$ に対して
	 \begin{equation*}
	  \D{i, 0} g_u(0,y) = \D{i, 0} g_u(1,y) = 0 ;
	 \end{equation*}
   \item \label{enum:inftyk}
	 任意の $i \in \N$, $j \in \{0, \dots, k\}$ に対して
	 \begin{equation*}
	  \left|\D{i,j} g_u(t,y)\right| \le 2^{\mu_i(|u|) - \gamma(|u|)};
	 \end{equation*}
   \item $h_u(1) = 2^{-\rho(|u|)}L(u)$.
  \end{enumerate}
 \end{lemma}


補題 \ref{DifferentiableFamily} とくらべて補題 \ref{KTimesFamily} は,
$\classPSPACE$ が \DIVPlog に置き換わり, $(\infty, 1)$ 回連続微分可能が 
$(\infty, k)$回連続微分可能に一般化されている.
本質的な違いは条件 (\ref{enum:inftyk}) によって, $h$ に対するフィードバックの大きさ,
つまり $g(t,y)$ に対する $y$ の値の影響がかなり制限されてしまう点にある.
それにより, 模倣できる差分方程式が多項式段ではなく対数段に制限され,
$\classPSPACE$ 困難が \DIVPlog 困難へと置き換わる.



 \begin{proof}
  $L \in \DIVPlog$ を認識する
  対数深さ離散初期値問題 $\left< d, p, q,(G_u)_u \right>$
  とその解 $(H_u)_u$ を得る. さらに以下のように仮定する.
  \begin{equation}
   H_u(i, 2^{q(|u|)}) = \begin{cases}
			L(u) & (i=p(|u|)) \\
			0 & (i<p(|u|)).
			\end{cases}
  \end{equation}

  補題 \ref{SmoothFunction} の $f$ に対して, 
  自然数の族 $c_i$ を各 $i \in \N$ に対して 
  $|\D{i}f(x)| \le 2^{c_i}$ を満たす最小の自然数と定める.
 定数 $d' = \lceil \log (4d + 1) \rceil$, 
 $B = 2^{\gamma(|u|) + d'}$ とおき, 
 各 $(t, y) \in [0,1] \times [-1, 1]$ に対して,
 自然数 $N$, $\theta \in [0,1]$, 整数 $Y$, $\eta \in [-1/4, 3/4]$ を
 $t = (T + \theta)2^{-q(|u|)}$, $y = (Y + \eta)B^{-k^{j_u(T)}}$ を満たすように
 定める.
 
 そのとき,
 \begin{equation}
  \delta_{u, Y} (t) = \frac{2^{q(|u|)} f'(\theta)}{B^{k^{j_u(T)+1}}} 
   G_u\left( j_u(T), T, \min \left(Y \bmod 2^{d'}\!\!\!,\ d-1 \right) \right)
 \end{equation}
 とおき $g_u, h_u$ を以下のように定義する.
 \begin{equation}
  g_u(t,y) 
  = \begin{cases}
     \delta_{u, Y}(t)
     & (\eta \le \frac 1 4)
     \\
     ( 1-f ( \frac{4\eta-1}{2})) \delta_{u, Y}(t) 
     + f ( \frac{4\eta-1}{2}) \delta_{u,Y+1}(t)
     & (\eta > \frac 1 4)
    \end{cases}
 \end{equation}

 \begin{equation} 
  h_u(t) = \sum^{p(|u|)}_{i=0} \frac{H_u(i, T)}{B^{k^i}}  
  + \frac{f(\theta)}{B^{k^{j_u(T)+1}}} G_u(j_u(T), T, H_u(j_u(T), T)) 
  \label{eq:hu}
 \end{equation}

 上記のように定義した $g_u, h_u$ が補題\ref{DifferentiableFamily} で求める
 性質を満たすことを示す. (i) は自明. 
 $(g_u)_u$ が多項式時間計算可能であることは
  補題 \ref{lem:type1representation}によって示される.

 $h_u$ は $g_u$ の常微分方程式の解であることを示す.
 まず $h_u$ について解析する. 
  $h_u(t) = (Y + \eta) B^{-k^{j_u(T)}}$ とおくときの, $\eta$ の範囲がどうなるか,
  つまり式(\ref{eq:gu})のどちらのケースを使うかを考える.
  式(\ref{eq:hu}) の一つ目の項において
 $i \le j_u(T)$ の合計は $B^{k^{j_u(T)}}$ の倍数なので $\eta$ に影響はない.
  $i > j_u(T)$ の合計は, 
 \begin{align*}
  \sum_{i>j_u(T)}^{p(|u|)} \frac{H_u(i, T)}{B^{k^i}} 
  & \le \sum_{i>j_u(T)}^\infty \frac{d-1}{B^{k^i}}  \\
  & \le \sum_{i>j_u(T)}^\infty \frac{d-1}{B^i} 
   = \sum_{i>j_u(T)}^\infty \frac{d-1}{B^{i-j_u(T)}}B^{-j_u(T)} \\
  & \le \sum_{i>j_u(T)}^\infty \frac{d-1}{(4d+1)^{i-j_u(T)}}B^{-j_u(T)} \\
  & = \frac{d-1}{4d}B^{-j_u(T)}
 \end{align*}
 二つ目の項の絶対値は
 \begin{equation}
  \left| \frac{f(\theta)}{B^{k^{j_u(T)+1}}} G_u(j_u(T), T, H_u(j_u(T), T)) \right|
  \le \frac{1}{B^{j_u(T)+1}}
  \le \frac{B^{-j_u(T)}}{4d+1}
 \end{equation}
 $(\frac{d-1}{4d} + \frac{1}{4d+1})B^{-j_u(T)} \le \frac 1 4 B^{-j_u(T)} $
  より $h_u(t) = (Y + \eta) B^{-j_u(T)}$ を満たす $\eta \in [-1/4, 1/4]$
 が存在する. このとき,
 \begin{equation}
  Y = \sum_{i=0}^{j_u(T)}H_u(i, T) \cdot B^{k^{j_u(T)} - k^i} .
 \end{equation}
 $B$ は $2^{d'}$ の倍数なので, 
 $\min (Y \bmod 2^{d'}\!\!\!,\ d-1) = \min (H_u(j_u), d-1) = H_u(j_u)$. 
 $g_u$ に代入すると,
 \begin{align*}
   g_u(t, h_u(t)) 
  & =  \frac{2^{q(|u|)} f'(\theta)}{B^{k^{j_u(T)+1}}}
   G_u(j_u(T), T, H_u(j_u(T), T)) \\
  & =  \D{1}h_u(t).
 \end{align*}
 よって $h_u$ は $g_u$ の常微分方程式の解.

  $g_u$ が $(\infty, k)$ 階連続的微分可能であることを証明する.
  $\eta$ が $[-1/4, 1/4]$ と $[1/4, 3/4]$ である区間それぞれにおいて微分する.
  任意の $i \in \N$ について

  \begin{equation}
   \D{i}\delta_{u,Y}(t) 
    = \frac{2^{(i+1)q(|u|)} \D{i+1}f(\theta)}{B^{k^{j_u(T)+1}}}
    G_u\left( j_u(T), T, \min \left(Y \bmod 2^{d'}\!\!\!,\ d-1 \right) \right)
  \end{equation}

  \begin{equation}
   \label{eq:derivativeofgu}
    \D{i,0} g_u(t, y)
     = \begin{cases}
 	\D{i} \delta_{u, Y}(\theta) 
	\hfill (- \frac 1 4 < \eta < \frac 1 4) \\
	\left( 1-f \left(\frac{4\eta-1}{2}\right)\right) 
	\D{i} \delta_{u, Y}(\theta) 
	+ f \left(\frac{4\eta-1}{2}\right) \D{i} \delta_{u,Y+1}(\theta) \\
	\hfill (\frac 1 4 < \eta < \frac 3 4)
       \end{cases}
  \end{equation}   
  $j \in \{1, \dots , k\}$ について,

  \begin{equation}
    \D{i,j} g_u(t, y)
     = \begin{cases}
	0 \hfill (- \frac 1 4 < \eta < \frac 1 4) \\
	(2B^{j_u(T)})^j \D{j}f(\frac{4\eta - 1}2)
	(\D{i}\delta_{u,Y+1}(\theta)-\D{i}\delta_{u, Y}(\theta)) \\
	\hfill (\frac 1 4 < \eta < \frac 3 4)
       \end{cases}
  \end{equation}
  $f$ は 無限回微分可能であるため, $\delta_{u,Y}$ も無限回微分可能である.
  よって 区間 $(-1/4, 1/4)$, $(1/4, 3/4)$ において
  $\D{i, 0} g_u$, $\D{i,j} g_u$ は連続. 
  $\eta = 1/4$ および  $\eta = 3/4(-1/4)$ においても連続であることは自明.
  $\D{i+1, 0} f(0) = \D{i+1, 0} f(1) = 0$ より $\theta = 0$ または $\theta = 1$
  において $\D{i, 0}g_u(t, y) = 0$, $\D{i, j}g_u(t, y) = 0$,
  よって $t$ についても連続.
  以上により $g_u$ は $(\infty, j)$ 階連続的微分可能であることが示された.

  式 (\ref{eq:derivativeofgu}) に $t = 0, 1$ ($\theta = 0$) を代入して
  $\D{i, 0} g_u(0,y) = \D{i, 0} g_u(1,y) = 0$.

  任意の $i \in \N$, $j \in \{0, \dots, k\}$ について
  $|\D{i,j} g_u| \leq 2^{\mu_i (|u|) - \gamma(|u|)}$ を示す.

  \begin{equation}
   |\D{i}\delta_{u, Y}(t)| 
    \le \left|\frac{2^{(i+1)q(|u|)}\D{i+1}f(\theta)}{B^{k^{j_u(T)+1}}} \right|
    \le \frac{2^{(i+1)q(|u|) + c_i}}{B^{k^{j_u(T)+1}}}\\
  \end{equation}

  $\mu_i(k) = (i+1)q(k) + \sum^k_{j=1}c_i + c_i + k + 1$ とおく.
  これは $\lambda$ に依存しない.
  $B$ の定義より

  \begin{align*}
   \left| \D{i,0} g_u \right| 
   &\le 
   |\D{i}\delta_{u, Y}(t)| 
    \le \frac{2^{(i+1)q(|u|) + c_i}}{B} 
    \le 2^{\mu_i (|u|) - \gamma(|u|)}
   \taghere 
   \\
   \left| \D{i,j} g_u \right| 
   & \le 
   (2B^{j_u(T)})^j \left|\D{j}f\left(\frac{4\eta - 1}2\right)\right|
   \cdot \left|\D{i}\delta_{u,Y+1}(t)-\D{i}\delta_{u, Y}(t)\right| \\
   & \le
   2^k B^{k \cdot j_u(T)} \cdot 2^{c_j} \cdot 
   2 \cdot \frac{2^{(i+1)q(|u|) + c_i}}{B^{k^{j_u(T)+1}}}\\
   & \le
   \frac{2^{(i+1)q(|u|) + \sum^k_{j=1}c_j + c_i +  k + 1}}{B}
   \le
   2^{\mu_i (|u|) - \gamma(|u|)} . \taghere
  \end{align*}

 (vii) は 
 \begin{align*}
  h_u(1) &= \frac{H_u(p(|u|), 2^{q(|u|)})}{B^{p(|u|)}}  \\
  &= \frac{L(u)}{2^{p(|u|) (\gamma(|u|) + d')}} \taghere
 \end{align*}
 より, $\rho(k) = p(k)(\gamma(k) + d')$ とおくと成り立つ.
 \end{proof}



\subsection{定理 \ref{KTimesIsCH} の証明}

定理 \ref{DifferentiableIsPspace} と定理 \ref{KTimesIsCH} の関係は
補題 \ref{DifferentiableFamily} と補題 \ref{KTimesFamily} の関係と等しい.
つまり $\classPSPACE$ が \DIVPlog に置き換わり,
$(\infty, 1)$ 回連続微分可能が $(\infty, k)$回連続微分可能に一般化されている.
よって定理 \ref{DifferentiableIsPspace} の証明から
定理 \ref{KTimesIsCH} の証明が構成できる.

%%% 証明は削除, master に残っているものを後でマージする.
