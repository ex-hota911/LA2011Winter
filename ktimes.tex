\section{任意回微分可能関数と常微分方程式}

 任意回微分可能な関数の常微分方程式の解も, ある仮定のもと \PSPACE 完全でありうることを
 証明する.

  \subsection{対数深さ離散初期値問題}
  前章で定義した離散初期値問題へさらに制限を加えた問題を考える.
  定数 $d$, 関数 $P \colon \N \to \N$, 多項式 $Q \colon \N \to \N$, 
  関数族 $(G_u)_u$ の組 $\left< d, P, Q, (G_u)_u \right>$が
  (\ref{enum:discreteode1}), (\ref{enum:discreteode2}) に加え,
  \begin{equation}
   P(x) = O(\log x) \text{かつ $P$ は多項式時間計算可能}
  \end{equation}
  を満たすとき対数深さ離散初期値問題であると呼ぶ.
  対数深さ離散初期値問題の解 $(H_u)_u$ が満たすべき条件は離散初期値問題と同じく
  (\ref{enum:discreteode3}), (\ref{enum:discreteode4}) である.

  対数深さ離散初期値問題が言語 $L$ を認識するとは任意の文字列 $u$ で
  $H_u(P(|u|), 2^{Q(|u|)}) = L(u)$ を満たすこと.

 \begin{hypothesis}
  \label{Hypothesis}
  任意の言語 $L \in$ \PSPACE に対して $L$ を認識する対数深さ離散初期値問題が
  存在する.
 \end{hypothesis}

 つまり対数深さ離散初期値問題が \PSPACE 完全であることを仮定する. 

 \subsection{対数深さ離散初期値問題を模倣する関数族}

 証明の流れは1回微分可能の時と変わらない.
 任意の言語 $L \in $ \PSPACE, 文字列 $u$ にたいして,
 上記の対数深さ離散初期値問題を模倣し $L(u)$ を計算する
 任意回微分可能な実関数 $g_u$ を構成する.

 \begin{lemma}
  \label{KTimesFamily}
  仮定 \ref{Hypothesis} のもと, 任意の自然数 $k \ge 2$,
  任意の言語 $L \in$ \PSPACE, 任意の多項式 $\lambda$ にたいして,
  関数 $\rho \colon \N \to \N$ と関数族 $g_u, h_u$ で,
  $\rho, (g_u)_u$ は多項式時間計算可能であり,
  各二進文字列 $u$ にたいして以下を満たすものが存在する.
  \begin{enumerate}
   \item $g_u\colon [0,1] \times [-1,1]\to \R, \quad h_u\colon [0,1] \to [-1,1]$;
   \item 任意の $y \in [-1,1]$ にたいして $g_u(0,y) = g_u(1,y) = 0 $;
   \item $h_u$ は $g_u$ の常微分方程式の解;
   \item $\D{0,k} g_u$ は連続;
   \item 任意の $i \in \{0, \dots, k\}$ にたいして
	 $\left|\D{0,i} g_u(t,y)\right| 
		\le \Lambda_u^{-i}2^{-|u|}$;
	 \label{enum:lem:differentiable}
   \item $h_u(1) = 2^{-\rho(|u|)}L(u)$.
  \end{enumerate}
  ただし $\Lambda_u = 2^{\lambda(|u|)}$.
 \end{lemma}
 
  \begin{proof}
  仮定 \ref{Hypothesis} より $L$ を認識する 
  対数深さ離散初期値問題 $\left< d, P, Q,(G_u)_u,(H_u)_u \right>$
  とその解 $(H_u)_u$ を得る.
  さらに以下のように仮定する.
  \begin{equation}
   H_u(i, 2^{Q(|u|)}) = \begin{cases}
			L(u) & (i=P(|u|)) \\
			0 & (i<P(|u|)).
			\end{cases}
  \end{equation}

    補題 \ref{SmoothFunction} の $f$ にたいして, 
 定数 $c$ を任意の $i \in \{0, \dots, k\}$, 任意の $x \in [0,1]$ にたいして $|\D i f(x)| \le 2^c$ を満たす最小の自然数と定める.
 定数 $d' = \lceil \log (4d + 1) \rceil$, 
 $B = 2^{\poly Q + k \poly \lambda + (k - 1) + |u| + c + d' + k}$ とおき, 
 各 $(t, y) \in [0,1] \times [-1, 1]$ にたいして,
 自然数 $N$, $\theta \in [0,1]$, 整数 $Y$, $\eta \in [-1/4, 3/4]$ を
 $t = (T + \theta)2^{-Q(|u|)}$, $y = (Y + \eta)B^{-(k+1)^{j_u(T)}}$ 
  を満たすように定める.
 
 そのとき,
 \begin{equation}
  g^*_u(t, Y) = \frac{2^\poly Q \pi \sin (\theta\pi)}{2 B^{(k+1)^{j_u(T)+1}}}
   G_u\left( j_u(T), T, \min \left(Y \bmod 2^{d'}\!\!\!,\ d-1 \right) \right)
 \end{equation}
 とおき $g_u, h_u$ を以下のように定義する.
 \begin{equation}
  g_u(t,y) 
  = \begin{cases}
     g^*_u(t, Y)& (\eta \le \frac 1 4) \\
     ( 1-f \left( 2\eta - \frac 1 2 \right)g^*_u(t, Y) 
     + f \left( 2\eta -  \frac 1 2 \right) g^*_u(t, Y+1)
     & (\eta > \frac 1 4)
    \end{cases}
  \label{ktimes:eq:gu}
 \end{equation}

 \begin{equation} 
  h_u(t) = \sum^{\poly P}_{i=0} \frac{H_u(i, T)}{B^{(k+1)^i}}
  + \frac{1-\cos(\theta\pi)}{2} 
  \cdot \frac{G_u(j_u(T), T, H_u(j_u(T), T))}{B^{(k+1)^{j_u(T)+1}}}
  \label{ktimes:eq:hu}
 \end{equation}

 上記のように定義した $g_u, h_u$ が補題\ref{KTimesFamily} で求める
 性質を満たすことを示す. (i), (ii) は自明. 
 $(g_u)_u$ が多項式時間計算可能であることは補題によって示される.

 $h_u$ は $g_u$ の常微分方程式の解であることを示す.
 まず $h_u$ について解析する. (\ref{ktimes:eq:hu}) の一つ目の項において
 $i \le j_u(T)$ の合計は $B^{(k+1)^{j_u(T)}}$ の倍数. $i > j_u(T)$ の合計は, 
 \begin{align*}
  \sum_{i>j_u(T)}^{\poly P} \frac{H_u(i, T)}{B^{(k+1)^i}} 
  & \le \sum_{i>j_u(T)}^\infty \frac{d-1}{B^{(k+1)^i}}  \\
  & \le \sum_{i>j_u(T)}^\infty \frac{d-1}{B^i} 
   = \sum_{i>j_u(T)}^\infty \frac{d-1}{B^{i-j_u(T)}}B^{-j_u(T)} \\
  & \le \sum_{i>j_u(T)}^\infty \frac{d-1}{(4d+1)^{i-j_u(T)}}B^{-j_u(T)} \\
  & = \frac{d-1}{4d}B^{-j_u(T)}
 \end{align*}
 二つ目の項の絶対値は
 \begin{equation}
  \left| \frac{1-\cos(\theta\pi)}{2} 
   \cdot \frac{G_u(j_u(T), T, H_u(j_u(T), T))}{B^{(k+1)^{j_u(T)+1}}} \right|
  \le \frac{1}{B^{j_u(T)+1}}
  \le \frac{B^{-j_u(T)}}{4d+1}
 \end{equation}
 よって $h_u(t) = (Y + \eta) B^{-j_u(T)}$ を満たす $\eta \in [-1/4, 1/4]$
 が存在する. このとき,
 \begin{equation}
  Y = \sum_{i=0}^{j_u(T)}H_u(i, T) \cdot B^{j_u(T) - i} .
 \end{equation}
 $B$ は $2^{d'}$ の倍数なので, 
 $\min (Y \bmod 2^{d'}\!\!\!,\ d-1) = \min (H_u(j_u), d-1) = H_u(j_u)$. 
 (\ref{ktimes:eq:gu})へ$Y$ と $\eta$ を代入すると,
  \begin{align*}
   g_u(t, h_u(t)) 
  & =  \frac{2^\poly Q \pi \sin(\theta\pi)}{2B^{j_u(T)+1}}
   G_u(j_u(T), T, H_u(j_u(T), T)) \\
  & =  \D{1}h_u(t). \taghere
  \end{align*}
 よって $h_u$ は $g_u$ の常微分方程式の解.


  \begin{align}
   &\D{0,i} g(t, y)  = \\
   & \begin{cases}
     0 & (\eta \le \frac 1 4) \\
     2^i  B^{i \cdot (k+1)^{j_u(T)}} \cdot \D{i} f\left(2\eta - \frac 1 2 \right)
      \cdot (g^*_u (t, Y+1)-g^*_u(t, Y))
     & (\eta > \frac 1 4)
     \end{cases} \notag
  \end{align}
  よって $\D{0,i} g$ は連続


  (v) を示す. $|g^*_u| 
  \le \left| \frac{2^\poly Q \pi \sin (\theta\pi)}{2 B^{(k+1)^{j_u(T)+1}}} \right|
  \le \frac{2^{\poly Q + 1}}{B^{(k+1)^{j_u(T)+1}}}$ より, 
  $i = 0$ において
  \begin{equation}
   |\D{0,0} g| = | g |  
    \le \frac{2^{\poly Q + 1}}{B^{(k+1)^{j_u(T)+1}}} 
    \le \frac{2^{\poly Q + 1}}{B^{(k+1)}} \le 2^{-|u|}
  \end{equation}
  $i \in \{1, \dots, k\}$ において,
  \begin{align*}
   | \D{0, i} g | & \le 2^i \cdot B^{i \cdot (k+1)^{j_u(T)}} \cdot 2^c \cdot
   (g^*_u (t, Y+1)-g^*_u(t, Y)) \\
   & \le 2^{c+k} \cdot B^{k(k+1)^{j_u(T)}} \cdot 2 \cdot \frac{2^{\poly Q + 1}}{B^{(k+1)^{j_u(T)+1}}} \\
   & \le \frac{2^{\poly Q + c + k + 2}}{B} 
   \le 2^{-i\poly \lambda - |u|}
    =  \Lambda_u^{-i}2^{-|u|} \taghere
  \end{align*}


  (vii) は 
  \begin{align*}
   h_u(1) &= \frac{H_u(\poly P, 2^\poly Q)}{B^{(k+1)^\poly P}}  \\
   &= \frac{L(u)}
   {2^{(k+1)^\poly P (\poly Q + k \poly \lambda + |u| + c + d' + k)}}   \taghere
  \end{align*}
  より, $\rho(x) = (k+1)^{P(x)} (Q(x) + k \lambda(x) + x + c + d' + k)$ とおく.
  $\poly P = O(\log |u|)$ かつ $P$ は多項式時間計算可能により, 
  $\rho$ は多項式時間計算可能.
  \end{proof}





 \subsection{定理 \ref{KTimesIsPspace} の証明}

\begin{proof}
 $L$ を \PSPACE 完全な言語, $\lambda(k) = 2k+2$ とおく.
 \PSPACE 完全な言語 $L$ にたいして補題 \ref{KTimesFamily} を用いて,
 $\rho$, $(g_u)_u$, $(h_u)_u$ を得る.
 \begin{align}
  c_u &= 1-\frac{1}{2^|u|}+\frac{2\bar{u}+1}{\Lambda_u},&
   l_u^\mp &= c_u\mp\frac{1}{\varLambda_u}
 \end{align}
 とおく. ただし $\bar u \in \{0, \dots, 2^{|u|} - 1\}$ は $u$ を二進数と
 して解釈した数.

 関数 $g,h$ を $t \in [0,1]$, $y \in \R$ にたいして, 下のように定義する.
 \begin{equation}
  g\left(l^\mp_u \pm \frac{t}{\Lambda_u}, \frac{y}{\Lambda_u}\right) \\
   = \begin{cases}
      \pm \displaystyle \sum_{i=0}^k \frac{\D{0,i}g_u(t,1)}{i!} (y-1)^i 
      &  (1<y) \\
      \pm g_u(t, y)      & (-1 \le y \le 1) \\
      \pm \displaystyle \sum_{i=0}^k \frac{\D{0,i}g_u(t,-1)}{i!} (y+1)^i  
      &  (1<y) \\
     \end{cases}
 \end{equation}
 \begin{equation}
  h \left( l^\mp_u \pm \frac{t}{\Lambda_u} \right) 
   = \frac{h_u(t)}{\Lambda_u}.
 \end{equation}
 任意の $y\in \R$ にたいして $g(1,y) = h(1) = 0$ と定義する.

 $g$と$h$が定理 \ref{DifferentiableIsPspace} で求める関数の性質を満たすことを示す.
 
 まず $g$ が多項式時間計算可能であることを示す.
 補題\footnote{準備で導入}を用いて示す.
 各有理数 $T,Y$ について $g(T, Y)$ を求めるとき,
 $T=l_u^\mp \pm t/\Lambda_u$, $Y = y/\Lambda_u$ を満たすような
 $u, \pm(\mp), t, y$ は, 多項式時間で計算可能である.

 次に $g$ が $y$ に関して微分可能であり, 導関数は $y$, $t$ に関して
 連続になっていることをしめす. 
 各区間で第二引数に関して微分すると $i \in {1,\dots,k}$ で
 \begin{equation}
  \D{0,j}g \left(l^\mp_u \pm \frac{t}{\Lambda_u}, \frac{y}{\Lambda_u} \right)
   = \begin{cases}
      \displaystyle \pm \Lambda_u^j \sum_{\left<i,j\right>\in S_k, i\ge n, j\ge m}^k 
      \frac{\D{0,i}g_u(t,1)}{(i-j)!} (y-1)^{(i-j)} & (1 < y) \\
      \pm \Lambda_u^j \D{0,j}g_u(t,y) & (-1 < y < 1) \\
      \displaystyle \pm \Lambda_u^j \sum_{i=j}^k 
      \frac{\D{0,i}g_u(t,-1)}{(i-j)!} (y+1)^{(i-j)} & (y < -1) 
     \end{cases}
 \end{equation}
 よって $\D{0,j}g(t, 1) = \pm \Lambda_u^j \D{0,j}g_u (t,1)$, 
 $\D{0,j}g(t, -1) = \pm \Lambda_u^i \D{0,j}g_u (t,-1)$ であり,
 $y$ に関して $i$ 回微分可能かつ$i$階の導関数は連続.
 
 $t$ 軸方向への $i$ 階の導関数の連続性について.
 任意の $[0,1)$ の数はある $u$ と $t \in [0,1]$ が存在して
 $l^\mp_u \pm t/\Lambda_u$ の形で表せる.
 $t \in (0,1)$ においては $\D{0,i}g_u(t, y)$は連続であるため, $t$軸方向へ連続.
 $t = 0, 1$ のとき, $y \in [-1, 1]$ にたいして $g_u(0, y) = g_u(1, y) = 0$ より
 $\D{0,i}g_u(0, y) = \D{0,i}g_u(1, y) = 0$
 よって $t = 0, 1$ においても連続.
 $g(1,y) = 0$ より $\D{0,i} g(1,y) = 0$.
 また $\left| \D{0,i}g_u \right| \le \Lambda_u^{-i} 2^{- |u|}$より,
 \begin{equation}
  \lim_{t \to 1-0} \left| \D{0,i}g \right|
   = \lim_{|u| \to \infty} \left| \Lambda_u^i \D{0,i}g_u \right| 
   \le \lim_{|u| \to \infty} \left| 2^{-|u|} \right|= 0.
 \end{equation}
 よって $\D{0,i}g$ は連続.

 $h$が$g$の常微分方程式の解であることを示す. 
 $h(0)=0, \quad \D{1}h(1) = 0 = g(1,h(1))$ は自明. 
 \begin{align*}
  \lefteqn{h'(l^\mp_u \pm t/\Lambda_u)} \\ 
  &=  \pm \frac{h'_u(t)}{\Lambda_u} \\ 
  &= \pm g_u \left(t, h_u(t)\right) \\ 
  &= g\left(l^\mp_u \pm \frac{t}{\Lambda_u},  
	\frac{h_u(t)}{\Lambda_u}\right) \\ 
  &= g\left(l^\mp_u \pm \frac{t}{\Lambda_u}, 
	h\left(l^\mp_u \pm \frac{t}{\Lambda_u}\right) \right) . \taghere
 \end{align*}

 $L$ は $h$ に還元可能であることを示す.
 \begin{equation}
  h(c_u) = \frac{h_u(1)}{\Lambda_u} 
   = \frac{L(u)}{2^{\lambda(|u|)+\rho(|u|)}}
 \end{equation}
 つまり $R,S,T$ を以下のように定義することで, 還元可能.
 \begin{align}
  R(u,v) &= v \\
  S(u, 0^n) &= \lfloor 2^nc_u \rfloor \text{を表す文字列,} \\
  T(u) &= 0^{\lambda(|u|)+\rho(|u|)}
 \end{align}
 $L$ は \PSPACE 完全であるため, $h$ も \PSPACE 完全.

\end{proof}



